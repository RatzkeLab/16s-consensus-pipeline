"""
16S Consensus Pipeline - Main Snakefile

This pipeline processes Oxford Nanopore long-read 16S rRNA sequencing data
to generate consensus sequences for each sample.
"""

configfile: "demo/default_config.yaml"

# Include rule modules
include: "rules/common.smk"
include: "rules/check.smk"
include: "rules/filter.smk"
include: "rules/subsample.smk"
include: "rules/align.smk"
include: "rules/consensus.smk"
include: "rules/multi_consensus.smk"
include: "rules/pool.smk"
include: "rules/summary.smk"

# ==================== Target Rule ====================

rule all:
    """
    Default target: generate both naive and multi-consensus databases and summary report.
    """
    input:
        # Checkpoint outputs
        CHECK_DIR / "read_check_summary.tsv",
        CHECK_DIR / "filtered_check_summary.tsv",
        # Final pooled databases
        NAIVE_DATABASE_FILE,
        MULTI_DATABASE_FILE,
        # Summary report
        OUT_DIR / "pipeline_summary.md"
    default_target: True
