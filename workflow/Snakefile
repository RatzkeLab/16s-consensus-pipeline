"""
16S Consensus Pipeline - Main Snakefile

This pipeline processes Oxford Nanopore long-read 16S rRNA sequencing data
to generate consensus sequences for each sample.
"""

configfile: "demo/default_config.yaml"

# Include rule modules
include: "rules/common.smk"
include: "rules/1_preprocessing.smk"
include: "rules/2_align.smk"
include: "rules/3_naive_consensus.smk"
include: "rules/4_clustering.smk"
include: "rules/5_cluster_consensus.smk"
include: "rules/6_summary.smk"

# ==================== Target Rule ====================

rule all:
    """
    Default target: generate both naive and multi-consensus databases and summary report.
    """
    input:
        # Checkpoint outputs
        CHECK_DIR / "read_check_summary.tsv",
        CHECK_DIR / "filtered_check_summary.tsv",
        # Final pooled databases
        NAIVE_DATABASE_FILE,
        MULTI_DATABASE_FILE,
        # Summary report
        OUT_DIR / "pipeline_summary.md"
    default_target: True
